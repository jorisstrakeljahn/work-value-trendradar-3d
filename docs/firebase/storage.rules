rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /signals/{signalId}/{allPaths=**} {
      // OWASP A04: Unrestricted File Upload - Validate file size and type
      // Only authenticated users can upload images with strict validation
      allow write: if request.auth != null
                   // File size must be less than 5MB (5 * 1024 * 1024 bytes)
                   && request.resource.size < 5 * 1024 * 1024
                   // Only allow image file types
                   && request.resource.contentType.matches('image/(jpeg|png|webp|gif)');
      
      // Anyone can view images (public read access)
      allow read: if true;
    }
  }
}
